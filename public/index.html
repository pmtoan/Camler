<!DOCTYPE html>
<html>
<head>
	<title>Index Camler</title>
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<style type="text/css">
		body{
			margin-left: 20px;
			font-family: "Open Sans";
		}
		table{
			border-collapse: collapse; border: 0.5px solid grey; margin-left: 10px; margin-bottom: 10px; font-family: "Open Sans";
		}
		table tr td{
			border: 0.5px solid grey; padding: 5px; max-width: 200px; min-width: 50px; font-family: "Open Sans";
		}
		h1{
			font-family: "Open Sans";
			border-bottom: solid #0099cc 2px;
		}      
		h2{
			border-bottom: solid #0099cc 1px;
			font-family: "Open Sans";
		}
		.info, .function{
			position: relative;
			padding: 10px;
			margin-bottom: 10px;
			margin-left: 50px;
		}
		.content input[type="text"], .content input[type="password"]{
			padding: 5px;
			font: 14px "Open Sans";
			border: solid #0099cc 1px;
			border-radius: 10px;
			margin-bottom: 10px;
			width: 200px;
		}
		button{
			width: 210px;
			padding: 5px;
			font: 18px "Open Sans"; 
			border: solid #0099cc 1px;
			border-radius: 10px;
			background-color: #0099cc; 
			color: white;
			margin-bottom: 10px;
		}
		button:hover{
			background-color: #007399; 
			color: white;
			cursor: pointer;
		}
		#capture-status, #scan-status{
			color: maroon;
			font-size: 12px;
			font-family: "Open Sans";
		}
	</style>
	<script type="text/javascript">
		function capture() {
			document.getElementById('capture-status').innerHTML = "";
			var ip = document.getElementById('ip').value;
			var user = document.getElementById('user').value;
			var pass = document.getElementById('pass').value;
			if (ip == "" || user == "" || pass == ""){
				alert("Missing ip or username or password");
			} else{
				var status = document.getElementById('capture-status');
				var xhttp = new XMLHttpRequest();
				var parameter = "ip=" + ip + "&user=" + user + "&pass=" + pass;
				xhttp.onreadystatechange = function() {
  					if (this.readyState == 4 && this.status == 200) {
    					status.innerHTML = this.responseText;
    				}
  				};
				xhttp.open("POST", "hcnetcapture", true);
				xhttp.send(parameter);
			}
		}
		function scanIP() {
			document.getElementById('scan-status').innerHTML = "";
			var table = document.getElementById('tb-info');
			var ipnet = document.getElementById('iprange').value;
			var dot = (ipnet.match(/\./g) || []).length;
			if (dot != 2){
				alert("IP Network not valid");
			}else{
				var parameter = "iprange=" + ipnet;
				document.getElementById('scan-status').innerHTML = "Scanning " + ipnet + ".0";
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {  					
					if (this.readyState == 4 && this.status == 200) {
						document.getElementById('scan-status').innerHTML = "Scan " + ipnet + ".0 done";
						var obj = JSON.parse(this.responseText);
    					table.innerHTML = "<tr><td>IP Address</td><td>Company</td></tr>";
    					for(var i=0;i<obj.length;i++)
    						table.innerHTML += "<tr><td>"+obj[i].ip+"</td><td>"+obj[i].company+"</td></tr>";
    				}
  				};
				xhttp.open("POST", "scanning", true);
				xhttp.send(parameter);
			}
		}
	</script>
</head>
<body>
	<div class="herder">
		<h1>Camera Information</h1>		
	</div>
	<div class="content">
		<div class="info">
			<h2>Camera IP and type of camera</h2>
			<input type="text" name="iprange" id="iprange" placeholder="IP Network"><br>
			<p id="note">Example IP Network: 172.22.22</p>
			<button id="btn-scan" onclick="scanIP()">Scan IP</button>
			<p id="scan-status"></p>
			<table id="tb-info">
			</table>
		</div>
		<div class="function">
			<h2>HIK VISION Capture</h2>
			<input type="text" name="ip" id="ip" placeholder="IP Address"><br>
			<input type="text" name="user" id="user" placeholder="Username"><br>
			<input type="password" name="pass" id="pass" placeholder="Password"><br>
			<button id="btn-capture" onclick="capture()">Capture</button>
			<p id="capture-status"></p>
		</div>
	</div>
	<div class="footer">
		
	</div>
</body>
</html>